function getValueFromInputArr(a){var b={};return $("input[name]",a).each(function(){var a=$(this),c=a.val(),d=a.attr("name");c&&d&&(b[d]=c)}),b}function submitFrom(a,b,c,d){$.post(a,b,function(a){a.isSuccess?c&&c(a.data):d&&d(a.msg)},"json")}function showErrorMsg(a,b){a.empty().append('<em class="text-danger">'+b+"</em>").show()}function validateEmail(a){var b=/^[a-z]([a-z0-9]*[-_]?[a-z0-9]+)*@([a-z0-9]*[-_]?[a-z0-9]+)+[\.][a-z]{2,3}([\.][a-z]{2})?$/i;return b.test(a)}function log(a){console&&console.log(a)}$(function(){topBarOptions.init(),sidebar.init(),signinPanel.init(),signupPanel.init()});var topBarOptions=function(){function a(){$("#topbar-options .menu").show(),c.emit("topbar-options:open")}function b(){$("#topbar-options .menu").hide(),c.emit("topbar-options:close")}var c=new Component;return c.init=function(){var d=null;$("#topbar-options").on("mouseenter",function(){d&&clearTimeout(d),a()}).on("mouseleave",function(){d=setTimeout(b,1e3)}),$("#pin").on("click",function(){$("#topbar-options").css("visibility","hidden"),b(),c.emit("topbar-options:pin_click")})},c.on("sidebar:pin_click",function(){$("#topbar-options").css("visibility","visible")}),c.on("signInBar_open",function(){b()}),c}(),sidebar=function(){function a(a){return function(b){var c=$(b.target).data("title"),d=51*a;$sidebar=$("#sidebar"),c&&$sidebar.append('<div class="nav-des" style="top:'+d+'px"><span class="narrow-left"></span><span class="nav-des-right">'+c+"</span></div>")}}function b(){$("#sidebar").show()}function c(){$("#sidebar").hide()}function d(){$("#sidebar .nav-des").remove()}var e=new Component;return e.init=function(){$("#sidebar a[data-title]").each(function(b,c){$(c).on("mouseenter",a(b+1)).on("mouseleave",d)}),$("#sidebar a:eq(0)").on("click",function(){c(),e.emit("sidebar:pin_click")})},e.on("topbar-options:pin_click",function(){b()}),e}(),signupPanel=function(){function a(){$("#signup-panel").slideUp("slow"),$(".bodyMask").hide(),f.emit("signup-panel:close")}function b(){$(".bodyMask").show(),$("#signup-panel").slideDown("slow"),f.emit("signup-panel:open")}function c(){$("#signup-panel").slideUp("slow"),$(".bodyMask").hide(),f.emit("signup-panel:signup-success")}function d(a){-1001===a.errCode&&showErrorMsg($("#signup-panel .error-username"),a.errMsgCn),-1002===a.errCode&&showErrorMsg($("#signup-panel .error-email"),a.errMsgCn)}function e(a){return $(".signin-panel .error-msg").each(function(){$(this).hide()}),a=a||{},a.username?a.email?validateEmail(a.email)?a.password?a.password2?a.password!==a.password2?(showErrorMsg($("#signup-panel .error-password2"),"密码不一致"),!1):!0:(showErrorMsg($("#signup-panel .error-password2"),"请确认密码"),!1):(showErrorMsg($("#signup-panel .error-password"),"请设置密码"),!1):(showErrorMsg($("#signup-panel .error-email"),"邮箱不合法"),!1):(showErrorMsg($("#signup-panel .error-email"),"请输入邮箱"),!1):(showErrorMsg($("#signup-panel .error-username"),"请输入称号"),!1)}var f=new Component;return f.init=function(){$("#signup-btn").on("click",b),$("#signup-panel .closeBtn").on("click",a),$("#doRegister").on("click",function(){var a=getValueFromInputArr($("#signup-panel"));e(a)&&submitFrom("/doRegister",a,c,d)})},f.on("topbar-options:open",a),f.on("signin-panel:open",a),f}(),signinPanel=function(){function a(){$(".bodyMask").show(),$("#signin-panel").slideDown("slow"),f.emit("signin-panel:open")}function b(){$(".bodyMask").hide(),$("#signin-panel").slideUp("slow"),f.emit("signin-panel:close")}function c(a){return $(".signin-panel .error-msg").each(function(){$(this).hide()}),a=a||{},a.email?validateEmail(a.email)?a.password?!0:(showErrorMsg($("#signin-panel .error-password"),"请输入密码"),!1):(showErrorMsg($("#signin-panel .error-email"),"邮箱不合法"),!1):(showErrorMsg($("#signin-panel .error-email"),"请输入邮箱"),!1)}function d(a){b(),f.emit("signin-panel:signin-success",a)}function e(a){-1001===a.errCode&&showErrorMsg($("#signin-panel .error-username"),a.errMsgCn),-1002===a.errCode&&showErrorMsg($("#signin-panel .error-email"),a.errMsgCn)}var f=new Component;return f.init=function(){$("#signin-btn").on("click",a),$("#signin-panel .closeBtn").on("click",b),$("#doLogin").on("click",function(){var a=getValueFromInputArr($("#signin-panel"));c(a)&&submitFrom("/doLogin",a,d,e)})},f.on("topbar-options:open",b),f.on("signup-panel:open",b),f}(),topBar=function(){function a(a){$("#signin-btn,#signup-btn").css("display","none"),$("#topbar-userinfo-avatar>img").attr("url",a.avertarUrl),$("#topbar-userinfo-upload,#topbar-userinfo-avatar").css("display","inline-block"),$("#topbar-userinfo-avatar").on("mouseenter",function(){$("#topbar-userinfo-menu").css("display","inline-block")}).on("mouseleave",function(){$("#topbar-userinfo-menu").css("display","none")})}var b=new Component;b.on("signup-panel:signup-success",a),b.on("signin-panel:signin-success",a)}();!function(a){var b={},c=function(){};c.prototype={on:function(a,c){return b[a]&&b[a].push?b[a].push(c):b[a]=[c],this},emit:function(c,d){if(b[c]&&b[c].push)for(var e=0;e<b[c].length;e++)b[c][e].call(a,d);return this}},a.Component=c}(window);